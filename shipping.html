<!DOCTYPE HTML>
<html lang="en">
<meta charset="utf-8">
	<head>
			<!-- <link href='https://fonts.googleapis.com/css?family=Ruda:400,700|Cantarell:400,700,400italic,700italic' rel='stylesheet' type='text/css'> -->
			<!-- <link href='https://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'> -->
			<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Doppio+One" rel="stylesheet">
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1"/>
			<meta name="keywords" content="maps,cartography, hazardous waste trade"/>
			<title>How is hazardous waste transported?</title>

			<!--put Bootstrap stylesheet links above style.css-->
			<!-- <link rel="stylesheet" href="CSS/bootstrap.min.css">
			<link rel="stylesheet" href="CSS/bootstrap-theme.min.css">
			<link rel="stylesheet" href="CSS/style.css"> -->
			<link rel="stylesheet" href="CSS/bootstrap.min.css">
			<link rel="stylesheet" href="CSS/style2a.css">
			<script type="text/javascript" src="lib/jquery-1.11.3.min.js"></script>
			<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
			<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
			<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
			<script type="text/javascript" src="lib/bootstrap.min.js"></script>
			<script type="text/javascript" src="lib/d3.js" charset="utf-8"></script>
			<script type="text/javascript" src="lib/queue.js"></script>
			<script type="text/javascript" src="lib/topojson.v1.min.js"></script>
			<script type="text/javascript" src="lib/tip.js"></script>
			<script type="text/javascript" src="lib/d3-save-svg.min.js"></script>
			<script src='lib/nprogress.js'></script>
			<link rel='stylesheet' href='CSS/nprogress.css'/>
			<script src="lib/w3HTMLinclude.js"></script>
			<!-- <script type="text/javascript" src="lib/bootstrap.min.js"></script>
			<script type="text/javascript" src="lib/d3.js" charset="utf-8"></script>
			<script type="text/javascript" src="lib/queue.js"></script>
			<script type="text/javascript" src="lib/topojson.v1.min.js"></script>
			<script src='lib/nprogress.js'></script>
			<link rel='stylesheet' href='CSS/nprogress.css'/>
			<script type="text/javascript" src="lib/tip.js"></script>
			<script src="lib/w3HTMLinclude.js"></script> -->

	</head>

	<body>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87476640-1', 'auto');
  ga('send', 'pageview');

</script>
	<div w3-include-html="nav.html"></div>
	<script>
	w3IncludeHTML();
	</script>
		<div class="jumbotron">
			<h1>How is hazardous waste transported?</h1>
		</div>


			<div class="col-md-8">
				<div class="col-md-12 map"></div>
			</div>
			<div class="col-md-4">
				<div class="col-md-12" id = "bodyText"><!-- <h4>Tracking the Flows of Waste through Clean Harbors' Sites</h4> -->
					<h5>The shipping manifests <a href="data.html">we compiled</a> from the EPA include the names of transporters and ports of entry into the US, but do not tell us the exact route the waste traveled. This is important because hazardous waste can affect communities along the routes it travels to be processed. This is why many communities have declared themselves or their streets off-limits to waste. We have represented hazardous waste shipments "as the crow flies" but this is misleading. In this map, we show a likely route for one of the most significant waste shipments we have found in our data: the shipment of vanadium, <a href="oilsands.html">a byproduct of oilsands extraction</a>. By weight, the trade between the Shell Scottford refinery and AMG (aka Metallurg Vanadium Corporation) in Ohio represents the single largest transaction. Shell sent AMG over 500 shipments between 2007 and 2012. 
					</h5>
					<br>
				</div>
				<div class="col-md-12" id="leftLegend"></div>
			</div>
			<br>
				<div class="col-md-12">
					<div class="col-md-4">
						<div class="col-md-12" id="bodyText">
						<h5>We examined a few of the <a href="https://geography.wisc.edu/hazardouswaste/map/data/manifests/CA.2011.HW.amg-shell%20scottford%20aOCR.pdf" target="_blank">shipping manifests</a> (right) and determined that the waste was often transported by two rail companies: Canadian Pacific (CP) and CSX. Using a dataset of all rail lines in Canada and Mexico, we calculated the likeliest path from Shell's facility in Canada to AMG's in Ohio. We know that the waste entered the US at Portal, ND. The path we illustrate above represents the shortest distance between the two sites, through Portal, and assumes that CP and CSX would prefer to ship over tracks they own or have rights to. Indeed, for the vast majority of this route (until Ohio), either CP or CSX own the tracks. Although in this example manifest the second transporter (CSX) did not sign off, we assume the took over somewhere around Chicago, where CP's rail network ends and CSX's begins.</h5>
						</div>
					</div>
					<div class="col-md-8">
						<img src="img/shippingManifest.png" id="manifest" alt="AMG-Shell shipping manifest"/>
					</div>

				</div>
	
							
								<script>
						//global variables
						var svg, zoomer, path, projection, width100, height100, globalMin, globalMax, arcGroup, exGlobalMin, exGlobalMax, siteKey, passwordExporter, password
						var defaultColor = "#D1D3D4", exDefaultColor = "#4D4D4F"
						var defaultStroke = {"stroke": "#262626", "opacity": 1}
						var u, b, t, imp, exp;
						  var tooltip = d3.tip()
						  .attr('class', 'd3-tip')
						  .offset([-5, 0])
						  .html(function(d) {
						    return "<span style='color:white'>" + siteKey[d] + "</span>";
						  })

						var flanneryScale;
						var format = d3.format(",.0f")  ;
						//scale stuff
						var windowWidth = window.innerWidth
						var smallCircle
						var bigCircle
						var mapScalar
						var mapHeightRatio
						function scaler (){
							if (windowWidth < 500) {
								smallCircle = 4
								bigCircle = 16
								mapScalar = 1.6
								mapHeightRatio = 2
							} else if (windowWidth > 500 && windowWidth < 1500) {
								smallCircle =  9
								bigCircle =  36
								mapScalar = 1.9
								mapHeightRatio = 1.2
							} else if (windowWidth > 1500) {
								smallCircle =  12
								bigCircle =  48
								mapScalar = 2.1
								mapHeightRatio = 1.1
							}
						}
						scaler()

						//begin script when window loads
						initialize();

						//the first function called once the html is loaded
						function initialize(){

						  height100 =  window.innerHeight/1.25
						  $(".map").height(height100/mapHeightRatio)
						  width100 = $(".map").width()

						  svg = d3.select(".map").append("svg")
						   .attr("id", "mapSVG")
						   .attr("height", height100/mapHeightRatio)
					    	.attr("width", width100)
					    	.attr("position", "absolute")
					    //.style({"height": height100, "width": width100, "position": "absolute"})
						  //create map projection
						  projection = d3.geo.albers()
						  .center([1,47])
						  .scale(height100/mapHeightRatio *mapScalar*1.5)
						  .translate([(width100)/2, (height100/mapHeightRatio )/2]);


						  path = d3.geo.path()
						    .projection(projection);

						  u = svg.append("g")
						  b = svg.append("g")
						   t = svg.append("g")

						  queue()
						    .defer(d3.json, "data/na.json")
						    .defer(d3.json, "data/borders.json")
						    .defer(d3.json, "data/shortestPathFinal.json")
						    .await(callback);

						    function callback(error, na, borders, shortPath){
						      b.selectAll('path')
						        .data(topojson.feature(borders, borders.objects.borders).features)
						        .enter().append("path")
						          .attr("d", path)
						          .attr("class", "borders")


						      u.selectAll("path")
						        .data(topojson.feature(na, na.objects.na).features)
						        .enter().append("path")
						          .attr("d", path)
						          .attr("class", function (d){
						            return d.properties.gu_a3
						          })
						          .attr("id", function (d){
						            return d.properties.postal
						          })

						      t.selectAll('path')
							        .data(topojson.feature(shortPath, shortPath.objects.shortestPathFinal).features)
							        .enter().append("path")
							          .attr("d", path)
							          .attr("stroke", "#f0ee14")
							          .attr("stroke-width", "3px")
							          .attr("fill", "none")
							        

						    };
						  setData();
						}

						function setData(){
						  NProgress.start();
						  svg.call(tooltip)

						  d3.csv("data/dataTest.csv", function(data) {

						    var totalShipments = data.length

						    d3.csv("data/lookup.csv", function(info) {
							  	password = d3.nest()
								  .key(function(d) { return d["ReceivingFacilityEPAIDNumber"] }) // EPA ID number
								  //.rollup(function(leaves) { return {"total_waste": d3.count(leaves, function(d) {return d.totalQuantityinShipment;})} }) // sum by receiving facility code
								  .map(info);
								passwordExporter = d3.nest()
								  .key(function(d) { return d["exporter_key"] }) // EPA ID number
								  //.rollup(function(leaves) { return {"total_waste": d3.count(leaves, function(d) {return d.totalQuantityinShipment;})} }) // sum by receiving facility code
								  .map(info);

							//data = data.filter(function(d){return d.Year == "2011" || d.Year == "2012"})
						    data = data.filter(function(row){
						      return row["exporter_key"].includes("E51A7093") && row["ReceivingFacilityEPAIDNumber"].includes("OHD042319244")
						     
						    })

						    var exporters = d3.nest() //rollup unique exportlatlongs
						    .key(function(d) {return d.exporter_key;})
						    .rollup(function(leaves) { return {"shipments": leaves.length}})
						    .map(data);

						    var importers = d3.nest() //rollup unique receivinglatlongs
						    .key(function(d) {return d.ReceivingFacilityEPAIDNumber})
						    .rollup(function(leaves) { return {"shipments": leaves.length}})
						    .map(data);

						    var nest = d3.nest()
						    .key(function(d) {return d.ReceivingFacilityEPAIDNumber})
						    .key(function(d) {return d.exporter_key;})
						    .rollup(function(leaves) { return {"shipments": leaves.length}})
						    .map(data);

						    siteKey={}
							data.forEach(function(d) {
							    siteKey[d.ReceivingFacilityEPAIDNumber] = password[d.ReceivingFacilityEPAIDNumber][0].importer_name+" - "+password[d.ReceivingFacilityEPAIDNumber][0].importer_city+", "+password[d.ReceivingFacilityEPAIDNumber][0].importer_state;
							    siteKey[d.exporter_key] = passwordExporter[d.exporter_key][0].exporter_name+" - "+passwordExporter[d.exporter_key][0].exporter_city+", "+passwordExporter[d.exporter_key][0].exporter_state;
							});



						  var map =d3.values(exporters).map(function(d){return d.shipments})
						  var max = d3.max(map),
						  min = d3.min(map)

						  var items = d3.keys(exporters).map(function(key) {
							    return [key, exporters[key].shipments];
							});
							// Sort the array based on the second element
							items.sort(function(first, second) {
							    return second[1] - first[1];
							});
						var exps = items.map(function(d){return d[0]})

						  exGlobalMax = max
						  exGlobalMin = min

						  var flanMax = calcFlanneryRadius(max);
						  flanneryScale = d3.scale.linear().domain([0, flanMax]).range([smallCircle, bigCircle]);


						    exp = svg.append("g")
						    exp.selectAll("circle")
						      .data(exps)
						      .enter().append("circle").attr("class", "circle")
						      //.attr("class", function(d) {return d.id+" "+d.state+d.years+" "+d.name})
						      .attr("id", function(d){return d})
						      .style("fill", exDefaultColor)
						      .style(defaultStroke)
						      .attr("cx", function(d) {return projection([passwordExporter[d][0].exporterLONG, passwordExporter[d][0].exporterLAT])[0]; })
						      .attr("cy", function(d) { return projection([passwordExporter[d][0].exporterLONG, passwordExporter[d][0].exporterLAT])[1]; })
						      .on("mouseover", function(d){
						        tooltip.show(d);
						      })
						      .on("mouseout", function(d){
						        tooltip.hide(d);
						      })
						    exp.selectAll("circle")
						      .transition()
						      .duration(1000)
						      .attr("r", function(d){return radiusFlannery(exporters[d].shipments)})


						   var map =d3.values(importers).map(function(d){return d.shipments})
						  var max = d3.max(map),
						  min = d3.min(map)

						  var items = d3.keys(importers).map(function(key) {
							    return [key, importers[key].shipments];
							});
							// Sort the array based on the second element
							items.sort(function(first, second) {
							    return second[1] - first[1];
							});
						var imps = items.map(function(d){return d[0]})

						  globalMax = max, globalMin = min

						  var flanMax = calcFlanneryRadius(max);
						  flanneryScale = d3.scale.linear().domain([0, flanMax]).range([smallCircle, bigCircle]);

						    imp = svg.append("g")
						     arcGroup = svg.append('g');
						    imp.selectAll("circle")
						      .data(imps)
						      .enter().append("circle").attr("class", "circle circleOnMap")
						      //.attr("class", function(d) {return d.id+" "+d.state+d.years+" "+d.name})
						      .attr("id", function(d){return d})
						      .style("fill", defaultColor)
						      .style(defaultStroke)
						      .attr("cx", function(d) {return projection([password[d][0].longitude, password[d][0].latitude])[0]; })
						      .attr("cy", function(d) { return projection([password[d][0].longitude, password[d][0].latitude])[1]; })
						      .on("mouseover", function(d){
						        tooltip.show(d);
						      })
						      .on("mouseout", function(d){
						        tooltip.hide(d);
						      })
						      .on("click", function(d){
						        
						      })
						    imp.selectAll("circle")
						      .transition()
						      .duration(1000)
						      .attr("r", function(d){exportThis(d, exporters, nest); return radiusFlannery(importers[d].shipments)})

						   p = svg.append("g")
						   p.selectAll("circle")
						      .data([0])
						      .enter().append("circle").attr("class", "circle circleOnMap")
						      //.attr("class", function(d) {return d.id+" "+d.state+d.years+" "+d.name})
						      .attr("id", function(d){return "portal"})
						      .style("fill", "red")
						      .style(defaultStroke)
						      .attr("cx", function(d) {return projection([-102.5476532,48.9960518])[0]; })
						      .attr("cy", function(d) { return projection([-102.5476532,48.9960518])[1]; })
						    p.selectAll("circle")
						      .transition()
						      .duration(1000)
						      .attr("r", 4)
						    p.selectAll("portalText")
						    .data([0]).enter().append("text")
						       .text("Portal, ND")
						       .attr("text-anchor", "right")
						       .attr("x", function(d) {return 12+projection([-102.5476532,48.9960518])[0]; })
						       .attr("y", function(d) { return projection([-102.5476532,48.9960518])[1]; })
						       .attr("class", "legendText")  


						  var flanMax = calcFlanneryRadius(globalMax);
						  flanneryScale = d3.scale.linear().domain([0, flanMax]).range([smallCircle, bigCircle]);

						  var stringwork2 = ["Importers","Exporters"]
						  var circleData = [[globalMax, defaultColor], [exGlobalMax, exDefaultColor]]
						  //var circleSpot = [34, 53, 58, 34, 54, 57]

						  var legendKey = ["AMG Vanadium", "Shell"]

							width100 = $("#leftLegend").width()
							//height100=$(".map").height()
							var scalar = window.innerWidth < 500 ? 3 : 2 //scale based on screen size
							$("#leftLegend").height(height100/scalar)
							d3.select("#leftLegend").append("div")
								.attr("class", "legDiv")
								.style({"width": width100, "height": (height100/scalar)+"px", "position": "absolute"})
							var leg = d3.selectAll(".legDiv").append("svg")
								.attr("id", "legSVG")
								.style({"width": width100, "height": (height100/scalar)+"px","position": "absolute"})

							 leg.selectAll("circle")
						      .data(circleData)
						      .enter()
						      .append("circle")
						      .style(defaultStroke)
						      //.attr("class", function(d) {return data.parent.name})
						      .style("fill", function(d){return d[1]})
						      .attr("r", function(d){return radiusFlannery(d[0])})
						      .attr("cy", function(d,i){
						      	//y position should be function of largest radius
						      	var def = window.innerWidth < 500 ? 35 : 60 //scale based on screen size
						      	var max = i > 0? exGlobalMax : globalMax
						      	var otherCirclesPosition = def + radiusFlannery(max) - radiusFlannery(d[0])
						      	var position = i == 0 ? def : otherCirclesPosition
						      	position = i > 0 ? position+2*radiusFlannery(max)+radiusFlannery(exGlobalMax) : position
						      	return position
						      })
						      .attr("cx", radiusFlannery(globalMax)+20)

						      function yScalar (d,i){
							 	var def = window.innerWidth < 500 ? 35 : 60 //scale based on screen size
							 	var max = i > 1 ? exGlobalMax : globalMax
						      	var otherCirclesPosition = def + radiusFlannery(max) - radiusFlannery(d[0])*2
						      	otherCirclesPosition = i > 0 ? otherCirclesPosition+2*radiusFlannery(max)+radiusFlannery(exGlobalMax) : otherCirclesPosition
						      	return otherCirclesPosition
							  }

						     leg.selectAll("circletitle")
						      .data(["Trading partners"])
						       .enter()
						       .append("text")
						       .text(function(d){return d})
						       .attr("text-anchor", "right")
						       .attr("x", 16)
						       .attr("y", 10) // + height100/1.5
						       .attr("class", "legendTitle")


						     leg.selectAll("circletext")
						      .data(circleData)
						       .enter()
						       .append("text")
						       .text(function(d, i){return legendKey[i]})
						       .attr("text-anchor", "right")
						       .attr("x", radiusFlannery(globalMax)*2+20)
						       .attr("y",function(d,i){
						       	return yScalar(d,i)
						       })
						       .attr("class", "legendText")


						     leg.selectAll("circlelines")
						     	.data([0])
						     	.enter()
						     	.append("line")          // attach a line
							    .style("stroke", "white")  // colour the line
							    .attr("x1", radiusFlannery(globalMax)+20)     // x position of the first end of the line
							    .attr("y1",  function(d,i){
							      	//y position should be function of largest radius
							      	return yScalar(d,i)
						      	})    // y position of the first end of the line
						      	.attr("x2", radiusFlannery(globalMax)+20)     // x position of the first end of the line
							    .attr("y2",  function(d,i){
							      	//y position should be function of largest radius
							      	return yScalar(d,i)
						      	})    // y position of the first end of the line
							    




						  leg.selectAll("flowline")
						    .data([globalMax])
						    .enter()
						    .append("rect")
						    //.attr("class", function(d) {return data.parent.name})
						    .style("fill", function(d){return "black"})
						    .attr("width", 100)
						    .attr("height", 15)
						    .attr("y", function(d,i){if(i==0){return radiusFlannery(globalMax)*6.5} else{return radiusFlannery(globalMax)*6+20}})
						    .attr("x", 16)

						  leg.selectAll("texts")
						    .data([globalMax])
						    .enter()
						    .append('text')
						    .attr("x", 16)
						    .attr("y", function(d,i){if(i==0){return radiusFlannery(globalMax)*6.5 -4} else{return radiusFlannery(globalMax)*6 +16}})
						    .text(function(d, i){if(i==0){return "Number of shipments: "+ globalMin}else{return "Maximum: "+globalMax}})
						    .attr("class", "legendText")
						  });
						})
						NProgress.done()
						function drawLinesOver(data, base){
						  //var max = d3.max(data, function(d) {return d.total_waste}),
						  //min = d3.min(data, function(d) {return d.total_waste})
						  console.log(data, base)
					

						  //based on: http://bl.ocks.org/enoex/6201948

						  var path = d3.geo.path()
						    .projection(projection);

						// --- Helper functions (for tweening the path)
						        var lineTransition = function lineTransition(path) {
						            path.transition()
						                //NOTE: Change this number (in ms) to make lines draw faster or slower
						                .duration(1500)
						                .attrTween("stroke-dasharray", tweenDash)
						                .each("end", function(d,i) {
						                    ////Uncomment following line to re-transition
						                    //d3.select(this).call(transition);

						                    //We might want to do stuff when the line reaches the target,
						                    //  like start the pulsating or add a new point or tell the
						                    //  NSA to listen to this guy's phone calls
						                    //doStuffWhenLineFinishes(d,i);
						                });
						        };
						        var tweenDash = function tweenDash() {
						            //This function is used to animate the dash-array property, which is a
						            //  nice hack that gives us animation along some arbitrary path (in this
						            //  case, makes it look like a line is being drawn from point A to B)
						            var len = this.getTotalLength(),
						                interpolate = d3.interpolateString("0," + len, len + "," + len);

						            return function(t) { return interpolate(t); };
						        };

						base = {"lat": password[base][0].latitude, "long":password[base][0].longitude}
						var links = [];
						for(var i=0, len=data.length; i<len; i++){
						    // (note: loop until length - 1 since we're getting the next
						    //  item with i+1)
						        links.push({
						            type: "LineString",
						            coordinates: [
						                [ data[i].long, data[i].lat ],
						                [ base.long, base.lat ]
						            ],
						            shipments: data[i].shipments
						        });
						    }
						var pathArcs = arcGroup.selectAll("arc")
						            .data(links);

						        //enter
						        var xPosition

        //enter
        pathArcs.enter()
            .append("path").attr({
                'class': 'arc'
            })
            .style({
                fill: 'none',
            })

        //update
            .attr("d", function(d){
            	//http://bl.ocks.org/d3noob/
            	var t = 0
            	var s = 1
		        var dx = projection(d.coordinates[t])[0] - projection(d.coordinates[s])[0],
		            dy = projection(d.coordinates[t])[1] - projection(d.coordinates[s])[1],
		            dr = Math.sqrt(dx * dx + dy * dy);

		        //when click on exporters, coordinates0 is base. click on importers, coordinates 1 is base
		        //calculate sweep flag based on whether x of target is to the right or left of x of source
		        var left = projection(d.coordinates[t])[0] < projection(d.coordinates[s])[0] ? true : false
		        var sweep = left == true ? 1 : 0
		        //Check if previous xposition was close. if so, flip sweep.
/*		        var flip = Math.abs(xPosition - projection(d.coordinates[0])[0]) < 150 ? true : false
		        console.log(flip)
		        if (flip == true && sweep == 0){sweep =1}
		       	else if (flip == true && sweep ==1){sweep = 0}*/

		        xPosition = projection(d.coordinates[t])[0]
		        //sweep = 0
		        return "M" +
		            projection(d.coordinates[0])[0] + "," +
		           projection(d.coordinates[0])[1] + "A" +
		            dr + "," + dr + " 0 0," + sweep + " " +
		            projection(d.coordinates[1])[0] + "," +
		           projection(d.coordinates[1])[1]
            })
						            .style("stroke", "black")
						            .attr("class", "arc")
						            .style('stroke-width', 15)
						                //'stroke-dasharray': '5'
						            .call(lineTransition); //at end of function call positions?
						}

				function exportThis(data, latlongs, nest){

						 
						  var latlongdump = [{"lat": passwordExporter[d3.keys(latlongs)[0]][0].exporterLAT, "long": passwordExporter[d3.keys(latlongs)][0].exporterLONG, "shipments":d3.values(latlongs)[0].shipments}]
						  console.log(d3.keys(latlongs)[0], d3.values(latlongs)[0].shipments)
						  //draw lines between exporters and this site
						  drawLinesOver(latlongdump, data);
						}
};
//various helper functions here: calculating flannery's compensation, and svg z-indexing.
						//flannery compensation for circles. modified from here: http://codepen.io/mxfh/pen/pggXoW
						var calcFlanneryRadius = function(x, max) {
						  // Flannery Compensation formula as described here:
						  //http://www.scribd.com/doc/33408233/SUG243-Cartography-Proportional-Symbol#scribd
						  // log x * 0.57
						  // anti log
						  var flannery = 0.57;
						  var log = Math.log(x);
						  var r = log * flannery;
						  r = Math.exp(r);
						  return (r);
						};

						var radiusFlannery = function(x) {
						  return flanneryScale(calcFlanneryRadius(x));
						};


						function prettify (d){
							console.log(d)
						  //for cutting a string down to size
						  d  = d.length > 30 ? d.slice(0,25)+"..." : d
						  return d
						}
</script>
	<div class="container"><div class="col-md-12"><p> </p></div></div>
          <div class="container"><div class="col-md-12"><p> </p></div></div>
				<div class="container">

				        <div class="col-md-4">
				  			<h4>Back to Story selection:</h4>
				  				<div class="thumbnail portfolio-thumbnail center-block" id = "image">
				  						<a href = "stories.html"><img src="img/storiesLanding.png"
				  						alt="Alberta Tar Sands"/>
				  						 <p class="imgDescription-col4">Story selection</p>
				  						</a>
				  				</div>
				  		</div>
				  		<div class="col-md-4">
				  			<h4>Further exploration:</h4>
				  				<div class="thumbnail portfolio-thumbnail center-block" id = "image">
				  						<a href = "hmm/index.html" target = "blank"><img src="img/hmmLanding.png"
				  						alt="Alberta Tar Sands"/>
				  						 <p class="imgDescription-col4">HazMatMapper</p>
				  						</a>
				  				</div>
				  				</div>
          </div>

			  		<br>
    <footer class="footer">
        <div w3-include-html="footer.html"></div>
    </footer>
	</body>
	<script>
	var origW = $("#manifest").width()
	var origH = $("#manifest").height()
	var colW = $(".col-md-8").width()
	var ratio = origW/origH
	ratio = isNaN(ratio) ? 1.3 : ratio
	var scalarW = window.innerWidth < 500 ? colW : origW //scale based on screen size
	scalarW = scalarW == 0 ? 721 : scalarW

	$("#manifest").width(scalarW)


	var scalarH = window.innerWidth < 500 ? scalarW/ratio : origH //scale based on screen size
	scalarH = scalarH == 0 ? scalarW/ratio : scalarH
	$("#manifest").height(scalarH)
</script>
	</html>